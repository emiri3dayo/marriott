<html>
<head>
  <title>Where have I stayed at Marriott?</title>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css"><script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="http://d3js.org/topojson.v2.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <style>svg { border: solid #ccc 1px; }
  path.country { fill: #ccc; stroke: "black";; }
  </style>
</head>

<body>
  <p>

  <svg id="svg1" height="400" width="1000"></svg>

  <script>
  var svg1 = d3.select("#svg1");

    var projection = d3.geoEquirectangular();
    var pathGenerator = d3.geoPath().projection(projection);

    var rawMap;
    var countries;



    d3.json("world-50m.json", function (error, data) {
      rawMap = data;

      countries = topojson.feature(rawMap, rawMap.objects.countries); //
      showMap();
      var interestingPoints =[[-77.6198,43],[-89,42],[139,35]];
      var places=["Rochester, NY", "Verona Wisconsin", "Tsukiji Tokyo"];
      var linePoints=[10,50,10]


      var circles=svg1.selectAll("circle").data(interestingPoints);
      circles.enter().append("circle").attr("r",1).style("fill","red")
      .merge(circles)
      .attr("cx", function(d) {return projection(d)[0]; })
      .attr("cy", function(d) {return projection(d)[1]; })



      var count=0
      places.forEach(function(d){
        svg1.append("text")
        .text(places[count])
        .style("fill", "blue")
        .style("font-size","10pt")
        .attr("x", function(d) {return projection(interestingPoints[count])[0]+30;})
        .attr("y", function(d) {return projection(interestingPoints[count])[1]+linePoints[count];});
        svg1.append("line")
        .style("stroke", "blue")
        .style("stroke-width",2)
        .attr("x1", function(d) {return projection(interestingPoints[count])[0];})
        .attr("y1", function(d) {return projection(interestingPoints[count])[1];})
        .attr("x2",function(d) {return projection(interestingPoints[count])[0]+30;})
        .attr("y2",function(d) {return projection(interestingPoints[count])[1]+linePoints[count];})
        count=count+1;
      });

    });



    function showMap() {
      projection.fitExtent([[0,0], [svg1.attr("width"), svg1.attr("height")]], countries);
      pathGenerator = d3.geoPath().projection(projection);


      var paths=svg1.selectAll("path.country").data(countries.features);
      paths.enter().append("path").attr("class","country").style("fill","#ccc").style("stroke","#888")
      .merge(paths)
      .attr("d", function(country){
        return pathGenerator(country)

      });
    };

      </script>
</p>
  <p id="p2">
    <svg id="svg2" height="600" width="1000"></svg>
    <script>



      var svg2 = d3.select("#svg2");
      var states;
      var marriottStays;
      var marriottCount=[];

      var projection2 = d3.geoAlbersUsa().scale(75).translate([500/2, 300/2]);
      var pathGenerator2= d3.geoPath().projection(projection2);

      console.log(projection2(-77))

      var divergingColors = ["#d8b365", "#f5f5f5", "#5ab4ac"];
      var sequentialColors = ['#e5f5f9','#99d8c9','#2ca25f'];

      d3.queue()
      .defer(d3.json,"us.json")
      .defer(d3.csv,"marriottstays.csv")
      .await(function (error, usMap, marriottStays) {


        states = topojson.feature(usMap, usMap.objects.states); //only show the states

        marriottUS=marriottStays.filter(function(d) {return d.Country=="USA";});
        console.log(marriottUS)

        count=0;
        for (var index in marriottUS){ //counts total number of marriott stays
          if (marriottUS.hasOwnProperty(index)){
            if (!(marriottUS[count].Hotel in marriottCount)){
              marriottCount[marriottUS[count].Hotel]=1

            } else {
              marriottCount[marriottUS[count].Hotel]+=1
            };
        count+=1
        }
      }
    console.log(marriottCount)


        showMap2();

      });


      function showMap2() {

        projection2.fitExtent([[0,0], [svg2.attr("width"), svg2.attr("height")]], states); //generates the states
        pathGenerator = d3.geoPath().projection(projection2);


        var paths=svg2.selectAll("path.country").data(states.features);
        paths.enter().append("path").attr("class","country").style("fill","#ccc").style("stroke","#888")
        .merge(paths)

        .attr("d", function(country){
          return pathGenerator2(country)
        });

        testarray=[[-77.6198,43.1066],[-73.8797,40.7692],[-77.6198,43.1066]];
        // var circles=svg2.selectAll("circle").data(testarray);
        // circles.enter().append("circle").attr("r",1).style("fill","red")
        // .merge(circles)
        // .attr("cx", function(d) {return projection2(d)[0]; })
        // .attr("cy", function(d) {return projection2(d)[1]; })
        // .attr("r",10)
        // .attr("fill","red")


        testarray.forEach(function(d){
          svg2.append("circle")
          .attr("cx", projection2(d)[0])
          .attr("cy", projection2(d)[1] )
          .attr("r", 10)
          .attr("fill", "blue");
        });


        console.log(marriottUS[4].Latitude)
        marriottUS.forEach(function(d){
          svg2.append("circle")
          .attr("cx", projection2([d.Latitude, d.Longitude])[0] )
          .attr("cy", projection2([d.Latitude, d.Longitude])[1] )
          .attr("r", 10)
          .attr("fill", "blue");

        });


      };



    </script>
  </p>
</body>
</html>
