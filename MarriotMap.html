<html>
<head>
  <title>Where have I stayed at Marriott?</title>
  <!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css"> -->
  <script src="http://d3js.org/topojson.v2.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.21.0/d3-legend.js"></script>
  <link rel="stylesheet" href="marriottStyle.css">


  <style>
  </style>
</head>

<body>


  <h1> Emiri's Marriott Adventures</h1>

  <p> While I was a project manager at Epic, I had the opportunity to travel across the world to different hospitals, and to travel.
  <br></br>A kind Marriott representative helped me compile my list of Stays from September 2013 to August 2016. It's a total of 76 stays.
  <br></br> If you hover over my different points, I've included the number of stays per each hotel. The radius of the circle is proportionate to the number of stays.
  <br></br> In the future, I would like to create a lookup to pull up the list of stays by hotel type.</p>
  <br></br>
  <br></br>
  <br></br>
  <h2>Stays in the World</h2>

  <svg id="svg1" height="400" width="1000"></svg>

  <script>
    var svg1 = d3.select("#svg1");

    var projection = d3.geoEquirectangular().scale(75).translate([500/2, 300/2]);
    var pathGenerator = d3.geoPath().projection(projection);

    var color = ["#00535F", "#046CB0", "#68C500", "#6BACE4", "#000000",  "#A6002F", "#6D1547"];
    var colorScale = d3.scaleOrdinal().domain(["AC Hotel", "Atlantis", "Courtyard", "Fairfield Inn", "JW Marriott", "Marriott", "Residence Inn"]).range(color);

    var rawMap;
    var countries;
    var marriottWorld;
    var marriottWorldCount=[];


    d3.queue()
      .defer(d3.json,"world-50m.json")
      .defer(d3.csv,"marriottStays.csv?_=6")
      .await(function (error, data, marriottWorld) {

      rawMap = data;

      countries = topojson.feature(rawMap, rawMap.objects.countries); //


      for (var index in marriottWorld){ //counts total number of marriott stays, stores lat, long,type of hotel into an array
        if ((marriottWorld.hasOwnProperty(index))&&(marriottWorld[index].hotelName!=undefined)){

          if (!(marriottWorld[index].hotelName in marriottWorldCount)){
            var temparray=[]
            temparray["State"]=marriottWorld[index].State
            temparray["count"]=1

            temparray["Latitude"]=marriottWorld[index].Latitude
            temparray["Longitude"]=marriottWorld[index].Longitude
            temparray["typeOfHotel"]=marriottWorld[index].typeOfHotel
            marriottWorldCount[marriottWorld[index].hotelName]=temparray
          }
          else {
            marriottWorldCount[marriottWorld[index].hotelName]["count"]+=1
          };
        };
      };
      var marriottWorldCountArray=[]
      for (var key in marriottWorldCount){
        if (marriottWorldCount.hasOwnProperty(key)){
          var obj=marriottWorldCount[key]
          obj["hotelName"]=key
          marriottWorldCountArray.push(obj)
        }
      };






      showWorld(marriottWorldCountArray);
      console.log(marriottWorldCountArray)



    });



    function showWorld(marriottWorldCountArray) {
      projection.fitExtent([[0,0], [svg1.attr("width"), svg1.attr("height")]], countries);
      pathGenerator = d3.geoPath().projection(projection);


      var paths=svg1.selectAll("path.country").data(countries.features); //creates map of US
      paths.enter().append("path").attr("class","country").style("fill","#B2B2B2").style("stroke","#FFFFFF")
      .merge(paths)
      .attr("d", function(country){return pathGenerator(country)
      });


      //modified code from Dave Gotz's using d3-tip with D3.js Version 4 http://bl.ocks.org/davegotz/bd54b56723c154d25eedde6504d30ad7

      var tooltip = d3.select("body").append("div").attr("class", "toolTip");;



      var countScale = d3.scaleSqrt();
      marriottWorldCountArray.forEach(function(d){

          svg1.append("circle") //creates circles for each of the hotel stays. radius is proportional to number of stays
            .attr("cx", projection([d.Latitude, d.Longitude])[0] )
            .attr("cy", projection([d.Latitude, d.Longitude])[1] )
            .attr("id", d.hotelName)
            .attr("stroke", colorScale(d.typeOfHotel))
            .attr("stroke-width",0.2)
            .attr("fill", colorScale(d.typeOfHotel))
            .attr("r", function() {
              return (countScale(d.count)*5); })
            .on("mousemove", function(){
              tooltip
                .style("left", d3.event.pageX - 50 + "px")
                .style("top", d3.event.pageY - 100 + "px")
                .style("display", "inline-block")
                .html("Hotel: "+d.hotelName+"</br>"+"Count: "+ d.count);
              })
            .on("mouseout", function(){ tooltip.style("display", "none");})
            .attr("fill-opacity","0.5");

          });




    };

      </script>
</p>

<br></br>
<br></br>
<br></br>
<h2> Stays in the US</h2>

  <p id="svg2"></p>
  <p id="svg3"></p>

    <svg id="svg2" height="600" width="1000"></svg>
    <script>
      var height = 600;
      var width = 1000;
      var padding = 50;

      var svg2 = d3.select("#svg2").append("svg")
      .attr("height", height).attr("width", width);

      var states;
      var marriottStays;
      var marriottCount=[];

      var projection2 = d3.geoAlbersUsa().scale(75).translate([500/2, 300/2]);
      var pathGenerator2= d3.geoPath().projection(projection2);



      var color = ["#00535F", "#046CB0", "#68C500", "#6BACE4", "#000000",  "#A6002F", "#6D1547"];
      var colorScale = d3.scaleOrdinal().domain(["AC Hotel", "Atlantis", "Courtyard", "Fairfield Inn", "JW Marriott", "Marriott", "Residence Inn"]).range(color);

      d3.queue()
      .defer(d3.json,"us.json")
      .defer(d3.csv,"marriottStays.csv?_=6")
      .await(function (error, usMap, marriottStays) {


        states = topojson.feature(usMap, usMap.objects.states); //filter only show the states

        marriottUS=marriottStays.filter(function(d) {return d.Country=="USA";}); //filter my data to just ones in the US



        for (var index in marriottUS){ //counts total number of marriott stays
          if (marriottUS.hasOwnProperty(index)){
            if (!(marriottUS[index].hotelName in marriottCount)){
              var temparray=[]
              temparray["State"]=marriottUS[index].State
              temparray["count"]=1

              temparray["Latitude"]=marriottUS[index].Latitude
              temparray["Longitude"]=marriottUS[index].Longitude
              temparray["typeOfHotel"]=marriottUS[index].typeOfHotel
              marriottCount[marriottUS[index].hotelName]=temparray
            }
            else {
              marriottCount[marriottUS[index].hotelName]["count"]+=1
            };
          };
        };
        var marriottCountArray=[]
        for (var key in marriottCount){
          if (marriottCount.hasOwnProperty(key)){
            var obj=marriottCount[key]
            obj["hotelName"]=key
            marriottCountArray.push(obj)
          }
        };


        showMap2(marriottCountArray);

      });


      function showMap2(marriottCountArray) {

        projection2.fitExtent([[0,0], [svg2.attr("width"), svg2.attr("height")]], states); //generates the states
        pathGenerator = d3.geoPath().projection(projection2);


        var paths=svg2.selectAll("path.country").data(states.features);
        paths.enter().append("path")
        .attr("class","country")
        .style("stroke","#FFFFFF")
        .merge(paths)
        .style("fill", "#D6E0D6")



        .attr("d", function(country){
          return pathGenerator2(country)
        });




        var tooltip = d3.select("body").append("div").attr("class", "toolTip");;

        var countScale = d3.scaleSqrt();
        marriottCountArray.forEach(function(d){ //creates circles, appends tooltip
            svg2.append("circle")
              .attr("cx", projection2([d.Latitude, d.Longitude])[0] )
              .attr("cy", projection2([d.Latitude, d.Longitude])[1] )
              .attr("id", d.hotelName)
              .attr("stroke", colorScale(d.typeOfHotel))
              .attr("stroke-width",0.2)
              .attr("fill", colorScale(d.typeOfHotel))
              .attr("r", function() {
                return (countScale(d.count)*5); })
              .on("mousemove", function(){
                tooltip
                  .style("left", d3.event.pageX - 50 + "px")
                  .style("top", d3.event.pageY - 100 + "px")
                  .style("display", "inline-block")
                  .html("Hotel: "+d.hotelName+"</br>"+"Count: "+ d.count);
                })
              .on("mouseout", function(){ tooltip.style("display", "none");})
              .attr("fill-opacity","0.5");

            });
          };


      //beginning of bar graph
      var height = 500;
      var width = 500;
      var padding = 50;

      var svg3 = d3.select("#svg3").append("svg")
      .attr("height", height).attr("width", width);

      console.log(marriottWorldCountArray)
      // var widthScale = d3.scale.linear().domain([0, publisherTotalsArray[0]["values"]]).range([300,800]);
      // var hotelScale = d3.scale.linear().domain([0,29]).range([100, 550]);
      // var g=barGraph.append("g")
      //   .attr("transform","translate(50,250)")
      //
      //
      // marriottWorldCountArray.forEach(function(d, i){//bar graph for publisher totals
      //   	barGraph.append("line")
      //     	.attr("x1", widthScale(0))
      //     	.attr("y1", hotelScale(i))
      //     	.attr("x2", widthScale(d.typeOfHotel))
      //     	.attr("y2", hotelScale(i))
      //     	.style("stroke",match(d.key))
      //     	.style("stroke-width", 15);
      //     barGraph.append("text")
      //       .attr("x", widthScale(d.values)+5)
      //       .attr("y",publisherScale(i)+4.5)
      //       .text(Math.ceil(d.values)+" mil")
      //       .style("fill", match(d.key))
      //       .style("font-family","arial")
      //     barGraph.append("text")
      //       .attr("x", 290)
      //       .attr("y", publisherScale(i)+4)
      //       .style("fill", match(d.key))
      //       .style("font-family","arial")
      //       .style("text-anchor","end")
      //       .text(d.key);
      //
      // });


    </script>

</body>
</html>
